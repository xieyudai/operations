基础环境
redis版本  redis-3.2.3

yum -y install ruby ruby-devel rubygems rpm-build

gem install redis

redis requires Ruby version >= 2.2.2的报错，查了资料发现是Centos默认支持ruby到2.0.0，可gem 安装redis需要最低是2.2.2
先安装rvm，再把ruby版本提升至2.3.3
安装curl
yum -y install curl

安装RVM
curl -L get.rvm.io | bash -s stable  
source /usr/local/rvm/scripts/rvm
查看rvm库中已知的ruby版本
rvm list known
安装一个ruby版本
rvm install 2.3.3
使用一个ruby版本
rvm use 2.3.3
设置默认版本
rvm remove 2.0.0
卸载一个已知版本
ruby --version
再安装redis就可以了
gem install redis


安装redis
cd /home/jutong/package
tar -zxvf redis-3.2.3.tar.gz
cd redis-3.2.3
make PREFIX=/home/jutong/software/redis
make PREFIX=/home/jutong/software/redis install

修改配置文件
cp /home/jutong/package/redis-3.2.3/src/redis-trib.rb /home/jutong/software/redis/bin/
mkdir -p /home/jutong/software/redis/{conf,data}
cp /home/jutong/package/redis-3.2.3/redis.conf /home/jutong/software/redis/conf/redis-6380.conf
分别在两台服务器上修改这些文件，如下，仅仅改对应的端口数字即可

vim /home/jutong/software/redis/conf/redis-6380.conf

# 基本配置
daemonize  yes
pidfile /home/jutong/software/redis/data/redis-6380.pid
port 6380
#bind (外网ip)
protected-mode no
unixsocket /home/jutong/software/redis/data/redis-6380.sock
unixsocketperm 700
timeout 300
loglevel verbose
logfile /home/jutong/logs/redis_logs/redis-6380.log
databases 16
dbfilename dump-6380.rdb
dir /home/jutong/software/redis/data/ 

# aof持久化
appendonly yes
appendfilename appendonly-6380.aof
appendfsync everysec
no-appendfsync-on-rewrite yes
auto-aof-rewrite-percentage 80-100
auto-aof-rewrite-min-size 64mb
lua-time-limit 5000

# 集群配置
cluster-enabled yes
cluster-config-file /home/jutong/software/redis/data/nodes-6380.conf 
cluster-node-timeout 5000

集群端口都起来
/home/jutong/software/redis/bin/redis-server /home/jutong/software/redis/conf/redis-6380.conf
/home/jutong/software/redis/bin/redis-server /home/jutong/software/redis/conf/redis-6381.conf

创建节点
/home/jutong/software/redis/bin/redis-trib.rb create --replicas 1 192.168.10.120:6380 192.168.10.120:6381 192.168.10.120:6382 192.168.10.121:6380 192.168.10.121:6381 192.168.10.121:6382

最后在配置文件里设置登录权限认证
vim /home/jutong/software/redis/conf/redis-6380.conf
masterauth 097e8b7cb7fd5
requirepass passwd
然后一个个节点重启

查看redis状态
cd /home/jutong/software/redis/bin
./redis-cli -h ip -p 7380 -a password
info
cluster info